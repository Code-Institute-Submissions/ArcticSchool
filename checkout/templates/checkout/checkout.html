{% extends 'base.html' %}
{% load static %}
{% block extra_title %}| Checkout{% endblock %}
{% block content %}

<!-- Checkout main container -->
<div id="checkout" class="my-auto">
    <!-- Main container -->
    <div class="container py-4">
        <h1 class="page-title my-2">Checkout</h1>
        <!-- Breadcrumbs -->
        <div class="row empty-box">
            <div class="breadcrumbs">
                <a href="{% url 'booking' %}"><i class="fas fa-chevron-left"></i> Back to Booking</a>
            </div>
        </div>
        <div class="row">
            <!-- Checkout Form & Payment Form -->
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6 order-form">
                <!-- Wrapped with card style -->
                <div class="card shadow-sm">
                    <!-- Form -->
                    <form action="{% url 'checkout' %}" id="form-checkout" method="POST">
                        {% csrf_token %}
                        <!-- Basic info -->
                        <fieldset>
                            <h4>Personal Information:</h4>
                            <hr>
                            {{ order_form.full_name | as_crispy_field}}
                            {{ order_form.email | as_crispy_field}}
                            {{ order_form.phone_number | as_crispy_field}}
                        </fieldset>
                        <fieldset class="mt-3">
                            <h4>Address Information:</h4>
                            <hr>
                            {{ order_form.street_address1 | as_crispy_field}}
                            {{ order_form.street_address2 | as_crispy_field}}
                            {{ order_form.town_or_city | as_crispy_field}}
                            {{ order_form.postcode | as_crispy_field}}
                            {{ order_form.county | as_crispy_field}}
                            {{ order_form.country | as_crispy_field}}
                        </fieldset>
                        <hr>
                        {% if user.is_authenticated %}
                        <label for="save-info">Save personal information</label>
                        <input type="checkbox" name="save-info" id="save-info" checked>
                        {% else %}
                        <div class="mt-4">
                            <span>If you want to save your infomration, please</span>
                            <label class="buttons" for="save-info">
                                <a href="{% url 'account_login' %}" class="btn hvr-bounce-to-right">Login</a>
                                <a href="{% url 'account_signup' %}" class="btn hvr-bounce-to-right">Register</a>
                            </label>
                        </div>
                        {% endif %}
                    </form>
                </div>
            </div>
            <!-- Booking Summary -->
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
                <!-- Wrapped with card style -->
                <div class="card shadow-sm form-margin mb-3">
                    <div class="booking-summary">
                        <h4>Summary</h4>
                        <p class="summary-text">Your booking summary includes all deductions & discount (if
                            applied)
                        </p>
                        <hr>
                        <div class="summary-totals">
                            <p>Total:
                                <span>£ {{ total|floatformat:2 }}</span>
                            </p>
                            <p>Discount:
                                {% if discount > 0 %}
                                <span>- £ {{ discount|floatformat:2 }}</span>
                                {% else %}
                                <span>£0</span>
                                {% endif %}
                            </p>
                            <hr>
                            <h6 class="grand-total">Grand Total:
                                <span>£ {{ grand_total|floatformat:2 }}</span>
                            </h6>
                        </div>
                    </div>
                </div>
                <!-- Wrapped with card style -->
                <div class="card shadow-sm form-margin">
                    <!-- Stripe payments section -->
                    <div class="booking-payment">
                        <!-- Stripe payments section -->
                        <form id="payment-form">
                            <fieldset>
                                <h4>Payment</h4>
                                <hr>
                                <div class="card-control mt-4 mb-1">
                                    <div id="card-element">
                                        <!-- Elements will create input elements here -->
                                    </div>
                                </div>
                                <!-- We'll put the error messages in this element -->
                                <div id="card-errors" role="alert"></div>
                            </fieldset>
                            <!-- Complete order button -->
                            <div class="buttons">
                                <button type="submit" id="submit" class="btn hvr-bounce-to-right">Make a
                                    Payment</button>
                            </div>
                            <p class="small m-0 mt-1">Your card will be charged £ {{ grand_total|floatformat:2 }}</p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
{% include 'layout/footer.html' %}

{% endblock %}

{% block extra_js %}
{{ block.supper }}
{{ stripe_public_key|json_script:"id_stripe_public_key" }}
{{ client_secret|json_script:"id_client_secret" }}
<script src="{% static 'js/stripe.js' %}"></script>
{% endblock %}